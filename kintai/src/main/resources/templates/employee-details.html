<div th:fragment="page">

 
  <div class="card">
    <div class="h1">社員情報</div>
    <div class="muted">社員詳細と月次勤怠を確認できます</div>

    <div class="spacer"></div>

    <table class="table">
      <tbody>
        <tr>
          <th style="width:180px;">ID</th>
          <td th:text="${employee.id}"></td>
        </tr>
        <tr>
          <th>Name</th>
          <td th:text="${employee.name}"></td>
        </tr>
        <tr>
          <th>Email</th>
          <td th:text="${employee.email}"></td>
        </tr>
        <tr>
          <th>Department</th>
          <td th:text="${employee.department}"></td>
        </tr>
      </tbody>
    </table>

    <div class="spacer"></div>

    <div class="row">
      <a class="btn" th:href="@{/ui/employees}">← 社員一覧へ戻る</a>
      <a class="btn btn-primary"
         th:href="@{'/ui/employees/' + ${employee.id} + '/csv?month=' + ${selectedMonth}}">
        CSVダウンロード
      </a>
    </div>
  </div>

  
  <div class="card">
    <div class="h2">月次勤怠</div>

    <form class="row"
          th:action="@{'/ui/employees/' + ${employee.id}}"
          method="get">
      <label>対象月</label>
      <input class="input" type="month" name="month" th:value="${selectedMonth}" required />
      <button class="btn btn-primary" type="submit">表示</button>

      <a class="btn"
         th:href="@{'/ui/employees/' + ${employee.id} + '?month=' + ${prevMonth}}">
        ◀ 前月
      </a>

      <a class="btn"
         th:href="@{'/ui/employees/' + ${employee.id} + '?month=' + ${nextMonth}}">
        次月 ▶
      </a>

      <span class="muted">
        表示中：<strong th:text="${selectedMonth}"></strong>
      </span>
    </form>

    <div class="spacer"></div>

    <div class="row">
      <div class="card" style="flex:1; margin-top:0;">
        <div class="muted">月合計労働時間</div>
        <div class="h1" th:text="${totalWorkedTime}"></div>
      </div>
    </div>
  </div>

  
  <div class="card">
    <div class="h2">勤怠登録</div>
    <div class="muted">日付を選択して出勤・退勤・休憩を登録します</div>

    <div class="spacer"></div>

    <div class="row">

      
      <form class="row"
            th:action="@{/ui/attendance/check-in}"
            method="post">
        <input type="hidden" name="employeeId" th:value="${employee.id}" />
        <input type="hidden" name="month" th:value="${selectedMonth}" />

        <label>日付</label>
        <input class="input" type="date" name="workDate" th:value="${today}" required />

        <label>出勤</label>
        <input class="input" type="time" name="time" required />

        <button class="btn btn-primary" type="submit">出勤</button>
      </form>

      
      <form class="row"
            th:action="@{/ui/attendance/check-out}"
            method="post">
        <input type="hidden" name="employeeId" th:value="${employee.id}" />
        <input type="hidden" name="month" th:value="${selectedMonth}" />

        <label>日付</label>
        <input class="input" type="date" name="workDate" th:value="${today}" required />

        <label>退勤</label>
        <input class="input" type="time" name="time" required />

        <button class="btn btn-primary" type="submit">退勤</button>
      </form>

     
      <form class="row"
            th:action="@{/ui/attendance/break}"
            method="post">
        <input type="hidden" name="employeeId" th:value="${employee.id}" />
        <input type="hidden" name="month" th:value="${selectedMonth}" />

        <label>日付</label>
        <input class="input" type="date" name="workDate" th:value="${today}" required />

        <label>休憩(分)</label>
        <input class="input" type="number" name="breakMinutes" min="0" value="60" required />

        <button class="btn" type="submit">休憩更新</button>
      </form>

    </div>
  </div>

 
  <div class="card">
    <div class="h2">勤怠一覧</div>

    <table class="table">
      <thead>
        <tr>
          <th>日付</th>
          <th>出勤</th>
          <th>退勤</th>
          <th>休憩(分)</th>
          <th>労働時間</th>
          <th>状態</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="a : ${attendances}">
          <td th:text="${a.workDate}"></td>
          <td th:text="${a.checkIn}"></td>
          <td th:text="${a.checkOut}"></td>
          <td th:text="${a.breakMinutes}"></td>
          <td th:text="${a.workedTime}"></td>

          
          <td>
            <span class="badge"
                  th:text="${a.statusLabel}"
                  th:classappend="
                    ${a.statusClass == 'status-work'} ? ' badge-work' :
                    (${a.statusClass == 'status-in'} ? ' badge-in' : ' badge-out')
                  ">
            </span>
          </td>

          <td>
            <a th:href="@{'/ui/attendance/' + ${a.id} + '/edit' + '?month=' + ${selectedMonth}}">
              編集
            </a>
          </td>
        </tr>

        <tr th:if="${#lists.isEmpty(attendances)}">
          <td colspan="7" class="muted">この月の勤怠データはありません</td>
        </tr>
      </tbody>
    </table>

    <div class="spacer"></div>

    <a class="btn" th:href="@{/ui/employees}">← 社員一覧へ戻る</a>
  </div>

</div>
